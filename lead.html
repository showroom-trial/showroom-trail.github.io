<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIA Showroom -Team Lead Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    
    <link rel="stylesheet" href="lead.css">
</head>
<body>
    <!-- Mobile Toggle Button -->
    <!-- <button class="toggle-btn">
        <i class="fas fa-bars"></i>
    </button> -->
    <header class="mobile-header" id="mobileHeader">
        <div class="mobile-header-content">
            <div class="logo-container">
                <img src="kia-logo.png" alt="KIA Logo" class="mobile-logo">
            </div>
            <button class="toggle-btn" id="mobileNavToggle">☰</button>
        </div>
    </header>
    
    <!-- <div class="top-section">
        <div class="top-section-right">
            <img src="kia-logo.png" alt="KIA Logo" class="header-logo">
        </div>
    </div> -->

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
               <!-- <div class="logo-container">
                    <div class="logo">KIA</div>
                    <div class="dashboard-type">Team Lead Dashboard</div>
                </div>-->
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div class="user-name">Alex Johnson</div>
                        <div class="user-role">Team Lead</div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <a href="#" data-section="lead-allocation-section" class="active">
                    <i class="fas fa-user-plus"></i> Lead Allocation
                </a>
                <a href="#" data-section="team-performance-section">
                    <i class="fas fa-chart-bar"></i> Team Performance
                </a>
                <a href="#" data-section="followups-section">
                    <i class="fas fa-phone"></i> Follow-ups
                </a>
                <a href="#" data-section="target-section">
                    <i class="fas fa-table"></i> Target Allocation
                </a>

                <a href="#" data-section="addons-section">
                    <i class="fas fa-tags"></i> Accessory Performance
                </a>
                <a href="#" data-section="comparison-section">
                    <i class="fas fa-trophy"></i> Executive Comparison
                </a>
              <!---  <a href="#" data-section="feedback-section">
                    <i class="fas fa-comment"></i> Customer Feedback
                </a>
                <!--<a href="#" data-section="settings-section">
                    <i class="fas fa-cog"></i> Settings
                </a>-->
            
                <!-- Corrected Logout Button -->
                <a href="#" id="logout-btn" class="nav-link">
                    <div class="nav-icon">🔒</div>
                    <span class="nav-text">Logout</span>
                </a>
            </div>            
        </div>
        
        <!-- KIA Logo -->
<div class="kia-logo-container">
    <img src="kia-logo.png" alt="KIA Logo" class="kia-logo">
</div> 
        <!-- Main Content -->
        <div class="main-content">
            <!-- 1. Lead Allocation Section -->
            <div id="lead-allocation-section" class="dashboard-section active">
                <div class="section-header">
                    <h1 class="section-title">Lead Allocation</h1>
                </div>
                
                <div class="cards-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Leads </h3>
                        </div>
                        <div class="card-value">12</div>
                        <div class="card-subtitle">
                            <span class="trend-up">↑ 4 from yesterday</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Leads completed </h3>
                        </div>
                        <div class="card-value">40/82</div>
                        <div class="card-subtitle">
                            <span class="trend-up">↑ 4% from yesterday</span>
                        </div>
                    </div>
                    
                    <!--<div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Pending Allocations</h3>
                        </div>
                        <div class="card-value">8</div>
                        <div class="card-subtitle">
                            <span>Need immediate attention</span>
                        </div>
                    </div>-->
                    
                    <!--<div class="card">
                        <div class="card-header">
                            <h3 class="card-title">In Progress Leads</h3>
                        </div>
                        <div class="card-value">45</div>
                        <div class="card-subtitle">
                            <span class="trend-up">↑ 5% from last week</span>
                        </div>
                    </div>-->
                    
                    <div class="card card-er-br">
    <div class="card-header">
        <h3 class="card-title">E/B Ratio</h3>
    </div>
    <div class="card-value">3.57</div>
    <div class="card-subtitle">
        <span class="trend-up">↑ 0.2 from last month</span>
    </div>
</div>

<div class="card card-er-br">
    <div class="card-header">
        <h3 class="card-title">B/R Ratio</h3>
    </div>
    <div class="card-value">1.14</div>
    <div class="card-subtitle">
        <span class="trend-up">↑ 0.05 from last month</span>
    </div>
</div>

                </div>
                
                <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Assigned Leads</h3>
                            <div class="table-buttons">
                                <button id="target-reminder-btn" class="dashboard-btn">Target Reminder</button>
                                <!--<button id="assign-target-btn" class="dashboard-btn">Assign Target</button>-->
                            </div>
                            <div class="table-actions">
                                <!-- Your existing search, filter, exports elements remain untouched -->
                        </div>
                        <h3 class="table-title">Assigned Leads</h3>
                        <div class="table-actions">
                            <input type="text" class="search-input" placeholder="Search leads..." data-table="leads-table">
                            <select class="filter-select" data-filter="status" data-table="leads-table">
                                <option value="all">All Status</option>
                                <option value="New">New</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Follow-up">Follow-up</option>
                                <option value="Closed-Won">Closed-Won</option>
                                <option value="Closed-Lost">Closed-Lost</option>
                            </select>
                            <select class="filter-select" data-filter="executive" data-table="leads-table">
                                <option value="all">All Executives</option>
                                <option value="Mark Wilson">Mark Wilson</option>
                                <option value="Sarah Davis">Sarah Davis</option>
                                <option value="Robert Johnson">Robert Johnson</option>
                                <option value="Jennifer Adams">Jennifer Adams</option>
                                <option value="Michael Carter">Michael Carter</option>
                            </select>
                            <button class="export-btn" data-table="leads-table">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
<!-- Modal for Target Status -->
<div id="targetStatusModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeTargetStatus">&times;</span>
        <h3>Target Status</h3>
        <div class="chart-container">
            <canvas id="executivePieChart"></canvas>
        </div>
        <button id="moreDetailsBtn" class="dashboard-btn">For More Details</button>
    </div>
</div>

<!-- Urgent Details-->
<div id="urgentLeadsPopup" class="popup">
    <div class="popup-content">
        <h3>Urgent Leads</h3>
        <p>You have urgent leads to follow up today!</p>
        <button id="viewFollowupsBtn">Tap for Details</button>
    </div>
</div><!-- Transparent Layer -->
<div id="assignTargetOverlay"></div>

<!-- Mini-tab for Assign Target --
<div id="assignTargetTab" class="mini-tab">
    <div class="mini-tab-header">
        <h3>Assign Target</h3>
        <span class="close-btn" id="closeAssignTarget">&times;</span>
    </div>
    <form id="assignTargetForm">
        <label for="executive">Select Executive:</label>
        <select id="executive" name="executive">
            <option value="Mark Wilson">Mark Wilson</option>
            <option value="Sarah Davis">Sarah Davis</option>
            <option value="Robert Johnson">Robert Johnson</option>
            <option value="Jennifer Adams">Jennifer Adams</option>
            <option value="Michael Carter">Michael Carter</option>
        </select>
        <label for="target">Target:</label>
        <input type="number" id="target" name="target" placeholder="Enter target" required>
        <button type="submit">Assign</button>
    </form>
</div>-->
                    <table id="leads-table">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Customer ID</th>
                                <th>Contact</th>
                                <th>Lead Source</th>
                                <th>Interested Model</th>
                                <th>Assigned Executive</th>
                                <th>Last Update</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="lead-1">
                                <td data-label="Customer Name">James Wilson</td>
                                <td data-label="Customer ID">CUS-101</td>
                                <td data-label="Contact">+1 234-567-8901</td>
                                <td data-label="Lead Source" data-source="Website">Website</td>
                                <td data-label="Interested Model">KIA Sportage</td>
                                <td data-label="Assigned Executive" data-executive="Mark Wilson">Mark Wilson</td>
                                <td data-label="Executive ID">EMP-2201</td>
                                <td data-label="Last Update">10 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Hot">Hot</span>
                                </td>
                                <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                            <tr id="lead-2">
                                <td data-label="Customer Name">Emily Johnson</td>
                                <td data-label="Customer ID">CUS-102</td>
                                <td data-label="Contact">+1 234-567-8902</td>
                                <td data-label="Lead Source" data-source="Walk-in">Walk-in</td>
                                <td data-label="Interested Model">KIA EV6</td>
                                <td data-label="Assigned Executive" data-executive="Sarah Davis">Sarah Davis</td>
                                <td data-label="Executive ID">EMP-2202</td>
                                <td data-label="Last Update">9 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Cold">Cold</span>
                                </td>
                                <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                            <tr id="lead-3">
                                <td data-label="Customer Name">David Brown</td>
                                <td data-label="Customer ID">CUS-103</td>
                                <td data-label="Contact">+1 234-567-8903</td>
                                <td data-label="Lead Source" data-source="Referral">Referral</td>
                                <td data-label="Interested Model">KIA Telluride</td>
                                <td data-label="Assigned Executive" data-executive="Robert Johnson">Robert Johnson</td>
                                <td data-label="Executive ID">EMP-2203</td>
                                <td data-label="Last Update">8 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Cold">Cold</span>
                                </td>
                               <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                            <tr id="lead-4">
                                <td data-label="Customer Name">Sarah Miller</td>
                                <td data-label="Customer ID">CUS-104</td>
                                <td data-label="Contact">+1 234-567-8904</td>
                                <td data-label="Lead Source" data-source="Social Media">Social Media</td>
                                <td data-label="Interested Model">KIA Sorento</td>
                                <td data-label="Assigned Executive" data-executive="Jennifer Adams">Jennifer Adams</td>
                                <td data-label="Executive ID">EMP-2204</td>
                                <td data-label="Last Update">7 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Warm">Warm</span>
                                </td>
                                <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                            <tr id="lead-5">
                                <td data-label="Customer Name">Michael Thompson</td>
                                <td data-label="Customer ID">CUS-105</td>
                                <td data-label="Contact">+1 234-567-8905</td>
                                <td data-label="Lead Source" data-source="Website">Website</td>
                                <td data-label="Interested Model">KIA K5</td>
                                <td data-label="Assigned Executive" data-executive="Michael Carter">Michael Carter</td>
                                <td data-label="Executive ID">EMP-2205</td>
                                <td data-label="Last Update">6 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Hot">Hot</span>
                                </td>
                                <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                            <tr id="lead-6">
                                <td data-label="Customer Name">Jessica Taylor</td>
                                <td data-label="Customer ID">CUS-106</td>
                                <td data-label="Contact">+1 234-567-8906</td>
                                <td data-label="Lead Source" data-source="Walk-in">Walk-in</td>
                                <td data-label="Interested Model">KIA Sportage</td>
                                <td data-label="Assigned Executive" data-executive="Mark Wilson">Mark Wilson</td>
                                <td data-label="Executive ID">EMP-2201</td>
                                <td data-label="Last Update">10 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Cold">Cold</span>
                                </td>
                               <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                            <tr id="lead-7">
                                <td data-label="Customer Name">Daniel Harris</td>
                                <td data-label="Customer ID">CUS-107</td>
                                <td data-label="Contact">+1 234-567-8907</td>
                                <td data-label="Lead Source" data-source="Referral">Referral</td>
                                <td data-label="Interested Model">KIA EV6</td>
                                <td data-label="Assigned Executive" data-executive="Sarah Davis">Sarah Davis</td>
                                <td data-label="Executive ID">EMP-2202</td>
                                <td data-label="Last Update">9 Mar, 2025</td>
                                <td data-label="Status">
                                    <span class="status-badge status-Warm">Warm</span>
                                </td>
                                <!--<td data-label="Action">
                                    <select class="status-select">
                                        <option value="New" selected>New</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Closed-Won">Closed-Won</option>
                                        <option value="Closed-Lost">Closed-Lost</option>
                                    </select>
                                </td>-->
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Lead Source Distribution</h3>
                    </div>
                    <canvas id="leadSourceChart"></canvas>
                </div>
            </div>
            
            <!-- 2. Team Performance Section -->
            <div id="team-performance-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Team Performance</h1>
                </div>
                
                <div class="cards-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Team Sales</h3>
                        </div>
                        <div class="card-value">56</div>
                        <div class="card-subtitle">
                            <span class="trend-up">↑ 8% from last month</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header"> 
                            <h3 class="card-title">Total Team Booking(E/B)</h3>
                        </div>
                        <div class="card-value">74%</div>
                        <div class="card-subtitle">
                            <span class="trend-up">↑ 10% from last month</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Team Retail (B/R)</h3>
                        </div>
                        <div class="card-value">32%</div>
                        <div class="card-subtitle">
                            <span class="trend-up">↑ 3% from last month</span>
                        </div>
                    </div>
                    
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Top Performer</h3>
                        </div>
                        <div class="card-value">Mark Wilson</div>
                        <div class="card-subtitle">
                            <span>16 sales this month</span>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Sales Contribution Per Executive</h3>
                    </div>
                    <canvas id="salesContributionChart"></canvas>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Team Members Performance</h3>
                        <div class="table-actions">
                            <button class="export-btn" data-table="team-performance-table">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <table id="team-performance-table">
                        <thead>
                            <tr>
                                <th>Executive Name</th>
                                <th>Total Leads</th>
                                <th>Active Leads</th>
                                <th>Closed Sales</th>
                                <th>E/B Ratio</th>
                                <th>B/R Ratio</th>
                               <!--<th>Contribution</th>-->
                                <th>Target Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td data-label="Executive Name">Mark Wilson</td>
                                <td data-label="Total Leads">42</td>
                                <td data-label="Active Leads">18</td>
                                <td data-label="Closed Sales">16</td>
                                <td data-label="Conversion Rate">38%</td>
                                <td data-label="Contribution">28.6%</td>
                                <td data-label="Target Progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 80%;"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Sarah Davis</td>
                                <td data-label="Total Leads">40</td>
                                <td data-label="Active Leads">20</td>
                                <td data-label="Closed Sales">14</td>
                                <td data-label="Conversion Rate">35%</td>
                                <td data-label="Contribution">25.0%</td>
                                <td data-label="Target Progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 70%;"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Robert Johnson</td>
                                <td data-label="Total Leads">38</td>
                                <td data-label="Active Leads">22</td>
                                <td data-label="Closed Sales">12</td>
                                <td data-label="Conversion Rate">29%</td>
                                <td data-label="Contribution">21.4%</td>
                                <td data-label="Target Progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%;"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Jennifer Lee</td>
                                <td data-label="Total Leads">36</td>
                                <td data-label="Active Leads">16</td>
                                <td data-label="Closed Sales">10</td>
                                <td data-label="Conversion Rate">27%</td>
                                <td data-label="Contribution">17.8%</td>
                                <td data-label="Target Progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 50%;"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Michael Brown</td>
                                <td data-label="Total Leads">24</td>
                                <td data-label="Active Leads">8</td>
                                <td data-label="Closed Sales">4</td>
                                <td data-label="Conversion Rate">16%</td>
                                <td data-label="Contribution">7.2%</td>
                                <td data-label="Target Progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 20%;"></div>
                                    </div>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
    <!-- Floating Customer Details Box -->
     <div id="customer-popup" style="display:none; position:fixed; width:5in; height:4in; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.2); padding:20px; border-radius:10px; top:20%; left:50%; transform:translateX(-50%); z-index:2000;">
         <div style="text-align:right;"><button onclick="closePopup()" style="background:none;border:none;font-size:18px;">✖</button></div>
         <div id="popup-content"></div>
    </div>
  <!----  <div class="cards-container">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Pending Reports</h3>
            </div>
            <div class="card-value">6</div>
            <div class="card-subtitle">
                <span class="trend-down">↓ 2 from last week</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Completed Reports</h3>
            </div>
            <div class="card-value">24</div>
            <div class="card-subtitle">
                <span class="trend-up">↑ 5 from last week</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Executives Reporting</h3>
            </div>
            <div class="card-value">6/8</div>
            <div class="card-subtitle">
                <span class="trend-up">Good Consistency</span>
            </div>
        </div>
    </div>-->

  <!-- ETBR Section --
    <div class="section-header">
        <h1 class="section-title">Enquiry Track Booking Report (ETBR)</h1>
    </div>

    <div class="cards-container">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Pending Reports</h3>
            </div>
            <div class="card-value">6</div>
            <div class="card-subtitle">
                <span class="trend-down">↓ 2 from last week</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Completed Reports</h3>
            </div>
            <div class="card-value">24</div>
            <div class="card-subtitle">
                <span class="trend-up">↑ 5 from last week</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Executives Reporting</h3>
            </div>
            <div class="card-value">6/8</div>
            <div class="card-subtitle">
                <span class="trend-up">Good Consistency</span>
            </div>
        </div>
    </div>-->

    <!-- Main Table: Team Members -->
<div class="table-container">
        <div class="table-header">
        <div class="table-header">
            <h3 class="table-title">Enquiry Track Booking Report (ETBR)</h3>
        </div>
            <div class="table-actions">
               <!-- <input type="file" id="excelFile" accept=".xlsx" class="dashboard-btn" />-->
                <button class="export-btn" data-table="leads-table">
                                <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
    <table id="etbr-full-table">
    <thead>
        <tr class="main-heading-row">
            <th rowspan="2">KEC's</th>
            <th colspan="3" class="enquiry-group">ENQUIRY</th>
            <th rowspan="2" class="td-group">TD</th>
            <th rowspan="2" class="td-group">TD%</th>
            <th colspan="3" class="booking-group">BOOKING</th>
            <th rowspan="2" class="eb-group">E/B</th>
            <th rowspan="2" class="br-group">B/R</th>
        </tr>
        <tr class="sub-heading-row">
            <th class="enquiry-group">TGT</th>
            <th class="enquiry-group">ACH</th>
            <th class="enquiry-group enquiry-end">%</th>
            <th class="booking-group">TGT</th>
            <th class="booking-group">ACH</th>
            <th class="booking-group booking-end">%</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Shilpa</td>
            <td>2</td><td>5</td><td>1%</td>
            <td>35</td><td>3%</td>
            <td>2</td><td>9</td><td>67%</td>
            <td>10%</td><td>8%</td>
        </tr>
        <tr>
            <td>Prathap</td>
            <td>1</td><td>4</td><td>1%</td>
            <td>50</td><td>9%</td>
            <td>8</td><td>18</td><td>89%</td>
            <td>10%</td><td>8%</td>
        </tr>
        <tr>
            <td>Dhanush E</td>
            <td>–</td><td>0</td><td>0%</td>
            <td>40</td><td>0%</td>
            <td>0</td><td>0</td><td>0%</td>
            <td>10%</td><td>8%</td>
        </tr>
        <tr>
            <td>Darshan</td>
            <td>–</td><td>4</td><td>2%</td>
            <td>40</td><td>4%</td>
            <td>4</td><td>10</td><td>100%</td>
            <td>6%</td><td>6%</td>
        </tr>
        <tr>
            <td>Kavya</td>
            <td>–</td><td>2</td><td>0%</td>
            <td>30</td><td>3%</td>
            <td>2</td><td>10</td><td>67%</td>
            <td>7%</td><td>7%</td>
        </tr>
        <tr>
            <td>Mohana</td>
            <td>–</td><td>1</td><td>0%</td>
            <td>20</td><td>1%</td>
            <td>1</td><td>5</td><td>100%</td>
            <td>5%</td><td>7%</td>
        </tr>
        <tr>
            <td>Yashwanth</td>
            <td>–</td><td>3</td><td>1%</td>
            <td>45</td><td>4%</td>
            <td>3</td><td>9</td><td>75%</td>
            <td>12%</td><td>4%</td>
        </tr>
        <tr>
            <td>Mallikarjun</td>
            <td>–</td><td>1</td><td>0%</td>
            <td>35</td><td>1%</td>
            <td>1</td><td>3</td><td>100%</td>
            <td>7%</td><td>6%</td>
        </tr>
        <tr>
            <td><strong>TEAM TOTAL</strong></td>
            <td><strong>3</strong></td><td><strong>21</strong></td><td><strong>5%</strong></td>
            <td><strong>260</strong></td><td><strong>24%</strong></td>
            <td><strong>21</strong></td><td><strong>64</strong></td><td><strong>83%</strong></td>
            <td><strong>9%</strong></td><td><strong>7%</strong></td>
        </tr>
        </tbody>
     </table> 
</div>

    <!-- Team Leader Comparison Table -->
    <div class="table-container">
        <div class="table-header">
            <h3 class="table-title">Team Leader Comparison</h3>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Team Leader</th>
                    <th>Total Target</th>
                    <th>Total Achieved</th>
                    <th>E/B</th>
                    <!--<th>KEC's</th>
                    <th>ENQUIRY</th>
                    <th>TD</th>-->
                    <th>B/R</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>You (Your Team)</strong></td>
                    <td>260</td><td>24</td><td>9%</td>
                    <!--<td>–</td><td>–</td><td>20</td>--><td>7%</td>
                </tr>
                <tr>
                    <td>Leader B</td>
                    <td>215</td><td>24</td><td>11%</td>
                    <!--<td>–</td><td>–</td><td>20</td>--><td>13%</td>
                </tr>
                <tr>
                    <td>Leader C</td>
                    <td>135</td><td>11</td><td>8%</td>
                    <!--<td>–</td><td>–</td><td>20</td>--><td>14%</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
            <!-- Follow-ups Section -->
 <div class="dashboard-section" id="followups-section">
    <div class="section-header">
        <h2>Follow-ups</h2>
    </div>

    <div class="alert-container">
        <div class="alert-card urgent">
            <div class="alert-icon">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="alert-content">
                <div class="alert-title">5 Urgent Follow-ups Due Today</div>
                <div class="alert-subtitle">Prioritize these customers</div>
            </div>
        </div>

        <div class="alert-card upcoming">
            <div class="alert-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="alert-content">
                <div class="alert-title">12 Follow-ups Tomorrow</div>
                <div class="alert-subtitle">Prepare in advance</div>
            </div>
        </div>
    </div>
<style>

/* General styling for the Follow-ups section */
#followups-section {
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    animation: fadeIn 1s ease-in-out;
}

/* Animation for the section */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Alert container styling */
.alert-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: space-between;
}

/* Alert card styling */
.alert-card {
    flex: 1 1 calc(50% - 10px);
    display: flex;
    align-items: center;
    padding: 15px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}

/* Hover effect for alert cards */
.alert-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* Alert icon styling */
.alert-icon {
    flex: 0 0 auto;
    font-size: 30px;
    color: #f44336; /* Default color for urgent */
    margin-right: 15px;
    animation: pulse 1.5s infinite;
}

/* Pulse animation for icons */
@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

/* Alert content styling */
.alert-content {
    flex: 1 1 auto;
}

/* Alert title styling */
.alert-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}

/* Alert subtitle styling */
.alert-subtitle {
    font-size: 14px;
    color: #666;
}

/* Specific styles for urgent alerts */
.alert-card.urgent .alert-icon {
    color: #f44336; /* Red for urgent */
}

.alert-card.urgent .alert-title {
    color: #f44336;
}

/* Specific styles for upcoming alerts */
.alert-card.upcoming .alert-icon {
    color: #4caf50; /* Green for upcoming */
}

.alert-card.upcoming .alert-title {
    color: #4caf50;
}

/* Responsive design for smaller screens */
@media (max-width: 768px) {
    .alert-card {
        flex: 1 1 100%;
    }
}
</style>
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Follow-up Schedule</h3>
                        <div class="table-actions">
                            <div class="search-container">
                                <input type="text" placeholder="Search by name" class="search-input">
                                <button class="search-btn"><i class="fas fa-search"></i></button>
                            </div>
                            <div class="filter-container">
                                <select class="filter-select">
                                    <option value="all">All Follow-ups</option>
                                    <option value="today">Due Today</option>
                                    <option value="tomorrow">Due Tomorrow</option>
                                    <option value="overdue">Overdue</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <table id="followup-table">
                        <thead>
                            <tr>
                                <th>Lead Name</th>
                                <th>Last Contact</th>
                                <th>Next Follow-up</th>
                                <th>Assigned To</th>
                                <th>Lead stage</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="urgent-row">
                                <td data-label="Lead Name">James Wilson</td>
                                <td data-label="Last Contact">Mar 8, 2025</td>
                                <td data-label="Next Follow-up">Mar 10, 2025</td>
                                <td data-label="Assigned To">Mark Wilson</td>
                                <td data-label="Conversion Probability">
                                    <div class="probability-bar high">
                                        <div class="probability-fill"></div>
                                        <span>85%</span>
                                    </div>
                                </td>
                                <td data-label="Status"><span class="status-badge status-Hot">Today</span></td>
                                 <td>
        <button class="status-update-btn" data-id="1">Details</button>
    </td>
                            </tr>
                            <tr class="urgent-row">
                                <td data-label="Lead Name">Emma Roberts</td>
                                <td data-label="Last Contact">Mar 5, 2025</td>
                                <td data-label="Next Follow-up">Mar 10, 2025</td>
                                <td data-label="Assigned To">Sarah Davis</td>
                                <td data-label="Conversion Probability">
                                    <div class="probability-bar medium">
                                        <div class="probability-fill"></div>
                                        <span>60%</span>
                                    </div>
                                </td>
                                <td data-label="Status"><span class="status-badge status-Hot">Today</span></td>
                                <td>
        <button class="status-update-btn" data-id="2">Details</button>
    </td>
                            <tr>
                                <td data-label="Lead Name">David Thompson</td>
                                <td data-label="Last Contact">Mar 9, 2025</td>
                                <td data-label="Next Follow-up">Mar 11, 2025</td>
                                <td data-label="Assigned To">Jennifer Lee</td>
                                <td data-label="Conversion Probability">
                                    <div class="probability-bar high">
                                        <div class="probability-fill"></div>
                                        <span>78%</span>
                                    </div>
                                </td>
                                <td data-label="Status"><span class="status-badge status-Warm">Tomorrow</span></td>
                                 <td>
                                <button class="status-update-btn" data-id="7">Details</button>
                            </td>
                            </tr>
                            <tr>
                                <td data-label="Lead Name">Richard Clark</td>
                                <td data-label="Last Contact">Mar 6, 2025</td>
                                <td data-label="Next Follow-up">Mar 12, 2025</td>
                                <td data-label="Assigned To">Robert Johnson</td>
                                <td data-label="Conversion Probability">
                                    <div class="probability-bar low">
                                        <div class="probability-fill"></div>
                                        <span>35%</span>
                                    </div>
                                </td>
                                <td data-label="Status"><span class="status-badge status-Cold">Scheduled</span></td>
                                 <td>
        <button class="status-update-btn" data-id="3">Details</button>
    </td>
                            </tr>
                            <tr class="overdue-row">
                                <td data-label="Lead Name">Patricia Hughes</td>
                                <td data-label="Last Contact">Mar 2, 2025</td>
                                <td data-label="Next Follow-up">Mar 9, 2025</td>
                                <td data-label="Assigned To">Michael Brown</td>
                                <td data-label="Conversion Probability">
                                    <div class="probability-bar medium">
                                        <div class="probability-fill"></div>
                                        <span>55%</span>
                                    </div>
                                </td>
                                <td data-label="Status"><span class="status-badge status-Hot">Overdue</span></td>
                                 <td>
        <button class="status-update-btn" data-id="4">Details</button>
    </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Add-ons Performance Section -->
            <div class="dashboard-section" id="addons-section">
                <div class="section-header">
                    <h2>Accessories Performance</h2>
                </div>
                
                <div class="charts-row">
                    <div class="chart-container half-width">
                        <div class="chart-header">
                            <h3 class="chart-title">Accessories Revenue Share</h3>
                        </div>
                        <canvas id="addonsRevenueChart"></canvas>
                    </div>
                    
                    <div class="chart-container half-width">
                        <div class="chart-header">
                            <h3 class="chart-title">Accessories Sales Trend</h3>
                        </div>
                        <canvas id="addonsTrendChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Accessories Sales by Executive</h3>
                    </div>
                    <table id="addons-table">
                        <thead>
                            <tr>
                                <th>Executive Name</th>
                                <th>Extended Warranty</th>
                                <th>Insurance</th>
                                <th>Accessories</th>
                                <th>Service Package</th>
                                <th>Total Accessories Revenue</th>
                                <th>% of Team Revenue</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td data-label="Executive Name">Mark Wilson</td>
                                <td data-label="Extended Warranty">12</td>
                                <td data-label="Insurance">14</td>
                                <td data-label="Accessories">25</td>
                                <td data-label="Service Package">10</td>
                                <td data-label="Total Add-ons Revenue">&#8377;28,450</td>
                                <td data-label="% of Team Revenue">32%</td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Sarah Davis</td>
                                <td data-label="Extended Warranty">10</td>
                                <td data-label="Insurance">12</td>
                                <td data-label="Accessories">22</td>
                                <td data-label="Service Package">8</td>
                                <td data-label="Total Add-ons Revenue">&#8377;24,300</td>
                                <td data-label="% of Team Revenue">27%</td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Robert Johnson</td>
                                <td data-label="Extended Warranty">8</td>
                                <td data-label="Insurance">9</td>
                                <td data-label="Accessories">18</td>
                                <td data-label="Service Package">9</td>
                                <td data-label="Total Add-ons Revenue">&#8377;19,850</td>
                                <td data-label="% of Team Revenue">22%</td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Jennifer Lee</td>
                                <td data-label="Extended Warranty">6</td>
                                <td data-label="Insurance">8</td>
                                <td data-label="Accessories">15</td>
                                <td data-label="Service Package">5</td>
                                <td data-label="Total Add-ons Revenue">&#8377;12,100</td>
                                <td data-label="% of Team Revenue">14%</td>
                            </tr>
                            <tr>
                                <td data-label="Executive Name">Michael Brown</td>
                                <td data-label="Extended Warranty">2</td>
                                <td data-label="Insurance">3</td>
                                <td data-label="Accessories">6</td>
                                <td data-label="Service Package">1</td>
                                <td data-label="Total Add-ons Revenue">&#8377;4,500</td>
                                <td data-label="% of Team Revenue">5%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Executive Comparison Section -->
            <div class="dashboard-section" id="comparison-section">
                <div class="section-header">
                    <h2>Executive Comparison</h2>
                </div>
                <!--
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Sales Leaderboard</h3>
                    </div>
                    <table id="sales-leaderboard">
                        
                        <thead>
                            <thead style="color: black;"></thead>
                            <tr>
                                <th>Rank</th>
                                <th>Executive Name</th>
                                <th>Total Sales</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="rank-1">
                                <td data-label="Rank">1</td>
                                <td data-label="Executive Name">Mark Wilson</td>
                                <td data-label="Total Sales">16</td>
                            </tr>
                            <tr class="rank-2">
                                <td data-label="Rank">2</td>
                                <td data-label="Executive Name">Sarah Davis</td>
                                <td data-label="Total Sales">14</td>
                            </tr>
                            <tr class="rank-3">
                                <td data-label="Rank">3</td>
                                <td data-label="Executive Name">Robert Johnson</td>
                                <td data-label="Total Sales">12</td>
                            </tr>
                        </tbody>
                    </table>
                </div>-->
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Performance Metrics Comparison</h3>
                    </div>
                    <table id="comparison-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Executive Name</th>
                                <th>Total Sales</th>
                                <th>Leads Closed</th>
                                <th>E/B</th>
                                <th>B/R</th>
                                <th>Accessories Sold</th>
                                <!--<th>Customer Satisfaction</th>-->
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="rank-1">
                                <td data-label="Rank">1</td>
                                <td data-label="Executive Name">Mark Wilson</td>
                                <td data-label="Total Sales">16</td>
                                <td data-label="Leads Closed">16/42</td>
                                <td data-label="Conversion Rate">38%</td>
                                <td data-label="Conversion Rate">28%</td>
                                <td data-label="Add-ons Sold">61</td>
                                <!--<td data-label="Customer Satisfaction">3.9/5</td>-->
                            </tr>
                            <tr class="rank-2">
                                <td data-label="Rank">2</td>
                                <td data-label="Executive Name">Sarah Davis</td>
                                <td data-label="Total Sales">14</td>
                                <td data-label="Leads Closed">14/40</td>
                                <td data-label="Conversion Rate">35%</td>
                                <td data-label="Conversion Rate">30%</td>
                                <td data-label="Add-ons Sold">52</td>
                                <!--<td data-label="Customer Satisfaction">3.9/5</td>-->
                            </tr>
                            <tr class="rank-3">
                                <td data-label="Rank">3</td>
                                <td data-label="Executive Name">Robert Johnson</td>
                                <td data-label="Total Sales">12</td>
                                <td data-label="Leads Closed">12/38</td>
                                <td data-label="Conversion Rate">29%</td>
                                <td data-label="Conversion Rate">20%</td>
                                <td data-label="Add-ons Sold">44</td>
                                <!--<td data-label="Customer Satisfaction">3.9/5</td>-->
                            </tr>
                            <tr>
                                <td data-label="Rank">4</td>
                                <td data-label="Executive Name">Jennifer Lee</td>
                                <td data-label="Total Sales">10</td>
                                <td data-label="Leads Closed">10/36</td>
                                <td data-label="Conversion Rate">27%</td>
                                <td data-label="Conversion Rate">25%</td>
                                <td data-label="Add-ons Sold">34</td>
                                <!--<td data-label="Customer Satisfaction">3.9/5</td>-->
                            </tr>
                            <tr>
                                <td data-label="Rank">5</td>
                                <td data-label="Executive Name">Michael Brown</td>
                                <td data-label="Total Sales">4</td>
                                <td data-label="Leads Closed">4/24</td>
                                <td data-label="Conversion Rate">16%</td>
                                <td data-label="Conversion Rate">12%</td>
                                <td data-label="Add-ons Sold">12</td>
                                <!--<td data-label="Customer Satisfaction">3.9/5</td>-->
                            </tr>
                        </tbody>
                    </table>
                </div>

                
                <!-- === Executive Daily Tasks Module (inside Executive Comparison) === -->
<div class="table-container" id="exec-task-module">
  <div class="table-header">
    <h3 class="table-title">Assign Daily Tasks</h3>
  </div>

  <!-- Task Form -->
  <form id="execTaskForm" class="task-form" autocomplete="off">
    <div class="task-form-row">
      <div>
        <label for="execTaskExecSelect">Executive Name</label>
        <select id="execTaskExecSelect" required></select>
      </div>
      <div>
        <label for="execTaskExecIdSelect">Executive ID</label>
        <select id="execTaskExecIdSelect">
          <option value="">Auto</option>
        </select>
      </div>
      <div>
        <label for="execTaskPriority">Priority</label>
        <select id="execTaskPriority" required>
          <option value="High">High</option>
          <option value="Medium" selected>Medium</option>
          <option value="Low">Low</option>
        </select>
      </div>
      <div>
        <label for="execTaskDueDate">Due Date</label>
        <input type="date" id="execTaskDueDate">
      </div>
    </div>

    <label for="execTaskDesc">Task Description</label>
    <textarea id="execTaskDesc" placeholder="Describe the task..." required></textarea>

    <button type="submit">Assign Task</button>
  </form>
</div>

<!-- Task Summary (per Executive) -->
<div class="table-container" id="exec-task-summary-container">
  <div class="table-header">
    <h3 class="table-title">Executive Task Summary</h3>
    <div class="table-actions">
      <button class="export-btn" data-table="exec-task-summary-table">
        <i class="fas fa-download"></i> Export
      </button>
    </div>
  </div>
  <table id="exec-task-summary-table">
    <thead>
      <tr>
        <th>Executive</th>
        <th>Exec ID</th>
        <th>Completed / Total</th>
        <th>Active</th>
        <th>High Pri</th>
      </tr>
    </thead>
    <tbody id="execTaskSummaryBody">
      <!-- JS fills -->
    </tbody>
  </table>
</div>

<!-- Expanded Task Detail Wrapper (auto-injected rows go here) -->
<!-- When a summary row is clicked, a detail row is dynamically inserted right after it -->

            </div>

<!-- Target Allocation Section -->
<div id="target-section" class="dashboard-section">
<div class="responsive-dashboard-container">

    <!-- Alarm Card (static at top) -->
    <div class="alarm-card" style="position:sticky;top:0;z-index:10;background:#fffbe7;color:#b26a00;border-left:6px solid #ffc107;padding:18px 24px;margin-bottom:18px;border-radius:8px;font-weight:bold;display:flex;align-items:center;box-shadow:0 2px 8px rgba(255,193,7,0.08);">
        <i class="fas fa-bell" style="margin-right:12px;font-size:1.5em;"></i>
        <span>Reminder: Please review and update your team's target allocations for this month!</span>
    </div>

    <!-- Cards Section -->
    <div class="cards-container" style="display:flex;gap:18px;flex-wrap:wrap;margin-bottom:28px;">
        <div class="card">
            <div class="card-title">Sales Targets Assigned</div>
            <div class="card-value" id="sales-assigned">--</div>
            <div class="card-subtitle">By Sales Manager</div>
        </div>
        <div class="card">
            <div class="card-title">Sales Completed</div>
            <div class="card-value" id="sales-completed">--</div>
            <div class="card-subtitle"><span class="card-highlight" id="sales-progress"></span> completed</div>
        </div>
        <div class="card">
            <div class="card-title">Revenue Target Achieved</div>
            <div class="card-value" id="revenue-achieved">--</div>
            <div class="card-subtitle"><span class="card-highlight" id="revenue-progress"></span> achieved</div>
        </div>
        <div class="card">
            <div class="card-title">Accessories Target Achieved</div>
            <div class="card-value" id="accessories-achieved">--</div>
            <div class="card-subtitle"><span class="card-highlight" id="accessories-progress"></span> achieved</div>
        </div>
        <div class="card">
            <div class="card-title">Targets Assigned to Executives</div>
            <div class="card-value" id="exec-targets">--</div>
            <div class="card-subtitle">of total team targets</div>
        </div>
    </div>

    <!-- Target Allocation Section -->
    <div class="target-section" style="background:#f9f9f9;border-radius:10px;padding:24px;margin-bottom:32px;">
        <h2 style="margin-bottom:18px;">Target Allocation</h2>
        <form class="target-form" id="targetForm" autocomplete="off">
            <label for="execSelect"><b>Select Executive:</b></label>
            <select id="execSelect" required></select>
            <div class="exec-details" id="execDetails"></div>
            <div class="target-form-row" style="display:flex;gap:32px;flex-wrap:wrap;margin-bottom:18px;">
                <div>
                    <label>Sales Target</label>
                    <input type="number" id="salesInput" min="0" placeholder="Add Sales">
                </div>
                <div>
                    <label>Revenue Target</label>
                    <input type="number" id="revenueInput" min="0" placeholder="Add Revenue">
                </div>
                <div>
                    <label>Accessories Target</label>
                    <input type="number" id="accessoriesInput" min="0" placeholder="Add Accessories">
                </div>
            </div>
            <button type="submit">Assign Target</button>
        </form>
    </div>

    <!-- Summary Table -->
    <div class="table-container">
        <div class="table-title">Executive Target Assignment Summary</div>
        <table>
            <thead>
                <tr>
                    <th>Executive</th>
                    <th>Sales (Completed / Assigned)</th>
                    <th>Revenue (Achieved / Assigned)</th>
                    <th>Accessories (Achieved / Assigned)</th>
                </tr>
            </thead>
            <tbody id="summaryBody"></tbody>
        </table>
    </div>

    <!-- Team Lead Target Info Alarm --
    <div id="lead-target-alarm" class="lead-target-alarm">
        <div class="alarm-title">
            <i class="fas fa-bullseye"></i> Team Target Overview
        </div>
        <div class="alarm-details" id="leadTargetAlarmDetails">
            <!-- JS will fill this -->
        </div>
    </div>
</div>
</div>

            
            <!-- Customer Feedback Section -->
            <div class="dashboard-section" id="feedback-section">
                <div class="section-header">
                    <h2>Customer Feedback</h2>
                </div>
                
                <div class="satisfaction-overview">
                    <div class="satisfaction-score">
                        <div class="score-circle">
                            <span class="score">4.5</span>
                            <span class="score-label">Overall Satisfaction</span>
                        </div>
                    </div>
                    <div class="satisfaction-breakdown">
                        <div class="rating-bar">
                            <div class="rating-label">5 ⭐</div>
                            <div class="rating-track">
                                <div class="rating-fill" style="width: 65%;"></div>
                            </div>
                            <div class="rating-percentage">65%</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-label">4 ⭐</div>
                            <div class="rating-track">
                                <div class="rating-fill" style="width: 25%;"></div>
                            </div>
                            <div class="rating-percentage">25%</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-label">3 ⭐</div>
                            <div class="rating-track">
                                <div class="rating-fill" style="width: 8%;"></div>
                            </div>
                            <div class="rating-percentage">8%</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-label">2 ⭐</div>
                            <div class="rating-track">
                                <div class="rating-fill" style="width: 1%;"></div>
                            </div>
                            <div class="rating-percentage">1%</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-label">1 ⭐</div>
                            <div class="rating-track">
                                <div class="rating-fill" style="width: 1%;"></div>
                            </div>
                            <div class="rating-percentage">1%</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Customer Satisfaction Trend</h3>
                    </div>
                    <canvas id="satisfactionTrendChart"></canvas>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Customer Reviews</h3>
                        <div class="table-actions">
                            <div class="filter-container">
                                <select class="filter-select" id="feedback-filter">
                                    <option value="all">All Reviews</option>
                                    <option value="positive">Positive (4-5 ★)</option>
                                    <option value="neutral">Neutral (3 ★)</option>
                                    <option value="negative">Negative (1-2 ★)</option>
                                </select>
                            </div>
                            <button class="export-btn" data-table="feedback-table">Export CSV</button>
                        </div>
                    </div>
                    <table id="feedback-table">
                        <thead class="feedback-table-header">
                            <tr>
                                <th>Customer</th>
                                <th>Rating</th>
                                <th>Sales Executive</th>
                                <th>Date</th>
                                <th>Feedback</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="positive-feedback" style="background-color: rgba(76, 175, 80, 0.1);">
                                <td data-label="Customer">John Smith</td>
                                <td data-label="Rating">
                                    <div class="stars">⭐⭐⭐⭐⭐</div>
                                </td>
                                <td data-label="Sales Executive">Mark Wilson</td>
                                <td data-label="Date">Mar 9, 2025</td>
                                <td data-label="Feedback">Mark was incredibly helpful and knowledgeable about all the KIA models. He made my buying experience stress-free and enjoyable.</td>
                            </tr>
                            <tr class="positive-feedback" style="background-color: rgba(76, 175, 80, 0.1);">
                                <td data-label="Customer">Amanda Jones</td>
                                <td data-label="Rating">
                                    <div class="stars">⭐⭐⭐⭐</div>
                                </td>
                                <td data-label="Sales Executive">Sarah Davis</td>
                                <td data-label="Date">Mar 8, 2025</td>
                                <td data-label="Feedback">Sarah was patient and took the time to understand exactly what I needed. She recommended the perfect car for my family.</td>
                            </tr>
                            <tr class="neutral-feedback" style="background-color: rgba(255, 193, 7, 0.1);">
                                <td data-label="Customer">Robert Miller</td>
                                <td data-label="Rating">
                                    <div class="stars">⭐⭐⭐</div>
                                </td>
                                <td data-label="Sales Executive">Jennifer Lee</td>
                                <td data-label="Date">Mar 7, 2025</td>
                                <td data-label="Feedback">The process was good overall, but I had to wait longer than expected for my test drive. Jennifer was knowledgeable though.</td>
                            </tr>
                            <tr class="negative-feedback" style="background-color: rgba(244, 67, 54, 0.1);">
                                <td data-label="Customer">Thomas Wright</td>
                                <td data-label="Rating">
                                    <div class="stars">⭐⭐</div>
                                </td>
                                <td data-label="Sales Executive">Michael Brown</td>
                                <td data-label="Date">Mar 5, 2025</td>
                                <td data-label="Feedback">Michael seemed disinterested and didn't answer my questions thoroughly. I felt rushed through the process.</td>
                            </tr>
                            <tr class="positive-feedback" style="background-color: rgba(76, 175, 80, 0.1);">
                                <td data-label="Customer">Elizabeth Chen</td>
                                <td data-label="Rating">
                                    <div class="stars">⭐⭐⭐⭐⭐</div>
                                </td>
                                <td data-label="Sales Executive">Robert Johnson</td>
                                <td data-label="Date">Mar 4, 2025</td>
                                <td data-label="Feedback">Robert was exceptional! He followed up consistently and made sure I got the best deal possible on my new KIA Sportage.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        
 // Wait for DOM to be fully loaded before initializing
// Wait for DOM to be fully loaded before initializing
// Wait for DOM to be fully loaded before initializing
document.addEventListener("DOMContentLoaded", function () {
    // Sidebar toggle for mobile
    let toggleButton = document.querySelector('.toggle-btn');
    let sidebar = document.querySelector('.sidebar');

    if (toggleButton && sidebar) {
        toggleButton.addEventListener('click', function () {
            sidebar.classList.toggle('active');
        });
    }

    // Handle sidebar navigation
    const menuItems = document.querySelectorAll('.sidebar-menu a, .menu-item');
    const sections = document.querySelectorAll('.dashboard-section');

    menuItems.forEach(item => {
        item.addEventListener('click', function (event) {
            event.preventDefault();

            // Remove active class from all menu items
            menuItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');

            // Get the section ID
            const sectionId = this.getAttribute('data-section');
            
            // Hide all sections
            sections.forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });

            // Show the correct section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
                
                // Special section handling
                if (sectionId === "feedback-section") {
                    const feedbackTable = document.getElementById("feedback-table");
                    if (feedbackTable) {
                        feedbackTable.style.display = "table";
                    }
                    // Initialize satisfaction chart when section is active
                    initializeSatisfactionChart();
                } else if (sectionId === "executive-comparison-section") {
                    const comparisonSection = document.getElementById("executive-comparison-section");
                    if (comparisonSection) {
                        comparisonSection.style.display = "block";
                        // Initialize sales leaderboard table
                        initializeSalesLeaderboard();
                    }
                }
            }

            // If sidebar is open on mobile, close it after clicking
            if (window.innerWidth <= 768 && sidebar) {
                sidebar.classList.remove('active');
            }
        });
    });

    // Ensure the first section is visible by default
    if (menuItems.length > 0) {
        menuItems[0].click();
    }

    // Logout button functionality
    let logoutButton = document.getElementById("logout-btn");
    if (logoutButton) {
        logoutButton.addEventListener("click", function(event) {
            event.preventDefault();
            window.location.href = "index.html"; // Redirect to login page
        });
    }
    
    // Filter feedback table
    const feedbackFilter = document.getElementById('feedback-filter');
    if (feedbackFilter) {
        feedbackFilter.addEventListener('change', function() {
            const filter = this.value;
            const rows = document.querySelectorAll('#feedback-table tbody tr');
            
            rows.forEach(row => {
                if (filter === 'all') {
                    row.style.display = '';
                } else if (filter === 'positive' && row.classList.contains('positive-feedback')) {
                    row.style.display = '';
                } else if (filter === 'neutral' && row.classList.contains('neutral-feedback')) {
                    row.style.display = '';
                } else if (filter === 'negative' && row.classList.contains('negative-feedback')) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }

    // Filter follow-up table
    const filterSelect = document.querySelector('.filter-select');
    if (filterSelect) {
        filterSelect.addEventListener('change', function() {
            const filter = this.value;
            const rows = document.querySelectorAll('#followup-table tbody tr');
            
            rows.forEach(row => {
                const statusCell = row.querySelector('[data-label="Status"] .status-badge');
                if (statusCell) {
                    const status = statusCell.textContent.toLowerCase();
                    
                    if (filter === 'all') {
                        row.style.display = '';
                    } else if (filter === 'today' && status === 'today') {
                        row.style.display = '';
                    } else if (filter === 'tomorrow' && status === 'tomorrow') {
                        row.style.display = '';
                    } else if (filter === 'overdue' && status === 'overdue') {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });
    }

    // Search functionality for follow-up table
    const searchInput = document.querySelector('.search-input');
    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#followup-table tbody tr');
            
            rows.forEach(row => {
                const nameCell = row.querySelector('[data-label="Lead Name"]');
                if (nameCell) {
                    const name = nameCell.textContent.toLowerCase();
                    if (name.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });
    }

    // Export table data
    const exportButtons = document.querySelectorAll('.export-btn');
    if (exportButtons.length > 0) {
        exportButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tableId = this.getAttribute('data-table');
                const table = document.getElementById(tableId);
                if (table) {
                    const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
                    
                    let csvContent = headers.join(',') + '\n';
                    
                    const rows = table.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const data = Array.from(row.querySelectorAll('td')).map(td => {
                            let content = td.textContent.trim();
                            // Replace commas in the content with a space to prevent CSV issues
                            content = content.replace(/,/g, ' ');
                            // Enclose in quotes if there's a space
                            if (content.includes(' ')) {
                                content = '"' + content + '"';
                            }
                            return content;
                        });
                        csvContent += data.join(',') + '\n';
                    });
                    
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `${tableId}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            });
        });
    }

    // Add CSS to control chart sizes and table styles
    const customStyles = document.createElement('style');
    customStyles.textContent = `
        .chart-container {
            position: relative;
            height: 350px;
            max-height: 350px;
            margin-bottom: 20px;
        }
        .chart-container canvas {
            max-height: 250px;
        }
        .satisfaction-overview {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .satisfaction-score {
            flex: 0 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .score {
            font-size: 36px;
            font-weight: bold;
            line-height: 1;
        }
        .score-label {
            font-size: 12px;
            text-align: center;
            margin-top: 5px;
        }
        .satisfaction-breakdown {
            flex: 1 1 60%;
            padding-left: 20px;
        }
        .rating-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .rating-label {
            width: 45px;
            text-align: right;
            margin-right: 10px;
            font-size: 14px;
        }
        .rating-track {
            flex: 1;
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }
        .rating-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
        }
        .rating-percentage {
            width: 40px;
            font-size: 14px;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .satisfaction-overview {
                flex-direction: column;
            }
            .satisfaction-score {
                margin-bottom: 15px;
                align-self: center;
            }
            .satisfaction-breakdown {
                padding-left: 0;
            }
        }
        #feedback-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #feedback-table th, #feedback-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        #feedback-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        #feedback-table tr:hover {
            background-color: #f9f9f9;
        }
        .positive-feedback {
            background-color: rgba(76, 175, 80, 0.1);
        }
        .neutral-feedback {
            background-color: rgba(255, 193, 7, 0.1);
        }
        .negative-feedback {
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        /* Sales Leaderboard Table Styles */
        #sales-leaderboard {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        #sales-leaderboard thead {
            background-color: #3f51b5;
            color: white;
        }
        #sales-leaderboard th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        #sales-leaderboard td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        #sales-leaderboard tbody tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        #sales-leaderboard tbody tr:hover {
            background-color: #e8eaf6;
        }
        .rank-cell {
            text-align: center;
            font-weight: bold;
        }
        .rank-1 {
            color: #000; /* Gold */
        }
        .rank-2 {
            color: #000; /* Silver */
        }
        .rank-3 {
            color: #000; /* Bronze */
        }
        .sales-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        .sales-bar {
            height: 15px;
            background: linear-gradient(90deg, #3f51b5, #5c6bc0);
            border-radius: 10px;
        }
        .sales-amount {
            font-weight: bold;
            text-align: right;
        }
        .trend-positive {
            color: #4CAF50;
        }
        .trend-negative {
            color: #F44336;
        }
        .lead-count {
            text-align: center;
        }
        #sales-leaderboard caption {
            caption-side: top;
            padding: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #3f51b5;
            background-color: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
        }
        .sales-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .period-selector {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: white;
            font-size: 14px;
        }
        .export-btn {
            padding: 8px 16px;
            background-color: #3f51b5;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .export-btn:hover {
            background-color: #303f9f;
        }
    `;
    document.head.appendChild(customStyles);
});

// Initialize charts with responsive options
function initializeCharts() {
    // Define common chart options for better responsiveness
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: {
                    boxWidth: 12,
                    font: {
                        size: 11
                    }
                }
            },
            title: {
                font: {
                    size: 14
                }
            }
        }
    };

    // Define chart data
    const leadSourceData = {
        labels: ['Referrals', 'Direct', 'Social Media', 'Email Campaign', 'Website', 'Trade Shows'],
        datasets: [{
            label: 'Lead Distribution',
            data: [30, 25, 15, 12, 10, 8],
            backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
            ],
            hoverBackgroundColor: [
                '#FF4C70', '#2F8FD5', '#FFBF3C', '#37A8A8', '#8652E8', '#FF8A22'
            ],
            borderWidth: 1
        }]
    };

    const addonsRevenueData = {
        labels: ['Premium Support', 'Training', 'Extended Warranty', 'Customization', 'Installation'],
        datasets: [{
            label: 'Revenue Share (%)',
            data: [35, 25, 20, 15, 5],
            backgroundColor: [
                '#00BCD4', '#4CAF50', '#FFC107', '#9C27B0', '#F44336'
            ],
            hoverBackgroundColor: [
                '#00A0B7', '#3F9142', '#D9A509', '#7E1F8E', '#D32F2F'
            ],
            borderWidth: 1
        }]
    };

    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'];
    
    const addonsTrendData = {
        labels: months,
        datasets: [
            {
                label: 'Premium Support',
                data: [12000, 13500, 14200, 15800, 17500, 18400, 19200, 21000, 22500, 24000],
                borderColor: '#00BCD4',
                backgroundColor: 'rgba(0, 188, 212, 0.2)',
                tension: 0.4,
                fill: true
            },
            {
                label: 'Training',
                data: [8500, 9000, 10500, 11000, 11800, 12500, 13000, 14000, 14800, 15500],
                borderColor: '#4CAF50',
                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                tension: 0.4,
                fill: true
            },
            {
                label: 'Extended Warranty',
                data: [7000, 7500, 8000, 8800, 9500, 10000, 10800, 11500, 12000, 12800],
                borderColor: '#FFC107',
                backgroundColor: 'rgba(255, 193, 7, 0.2)',
                tension: 0.4,
                fill: true
            }
        ]
    };

    // Initialize charts if their canvas elements exist
    
    // Lead Source Distribution (Pie Chart)
    const leadSourceCanvas = document.getElementById('leadSourceChart');
    if (leadSourceCanvas) {
        new Chart(leadSourceCanvas, {
            type: 'pie',
            data: leadSourceData,
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    title: {
                        display: true,
                        text: 'Lead Source Distribution',
                        font: { size: 14 }
                    },
                    legend: {
                        position: 'right',
                        labels: {
                            boxWidth: 12,
                            font: { size: 11 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${percentage}% (${value})`;
                            }
                        }
                    }
                }
            }
        });
    }

    // Add-ons Revenue Share (Doughnut Chart)
    const addonsRevenueCanvas = document.getElementById('addonsRevenueChart');
    if (addonsRevenueCanvas) {
        new Chart(addonsRevenueCanvas, {
            type: 'bar',
            data: addonsRevenueData,
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    title: {
                        display: true,
                        text: 'Accessories Revenue Share',
                        font: { size: 14 }
                    },
                    legend: {
                        position: 'right',
                        labels: {
                            boxWidth: 12,
                            font: { size: 11 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });
    }

    // Add-ons Sales Trend (Line Chart)
    const addonsTrendCanvas = document.getElementById('addonsTrendChart');
    if (addonsTrendCanvas) {
        new Chart(addonsTrendCanvas, {
            type: 'line',
            data: addonsTrendData,
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    title: {
                        display: true,
                        text: 'Accessories Sales Trend',
                        font: { size: 14 }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Revenue ($)',
                            font: { size: 11 }
                        },
                        ticks: {
                            font: { size: 10 }
                        }
                    },
                    x: {
                        ticks: {
                            font: { size: 10 }
                        }
                    }
                }
            }
        });
    }
}

// Initialize satisfaction chart separately
function initializeSatisfactionChart() {
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'];
    
    const satisfactionTrendData = {
        labels: months,
        datasets: [
            {
                label: 'Satisfaction Score (0-10)',
                data: [7.5, 7.8, 8.0, 8.2, 8.3, 8.5, 8.4, 8.6, 8.8, 9.0],
                borderColor: '#FF5722',
                backgroundColor: 'rgba(255, 87, 34, 0.2)',
                tension: 0.4,
                fill: true,
                yAxisID: 'y'
            },
            {
                label: 'Response Rate (%)',
                data: [65, 68, 72, 75, 78, 80, 82, 85, 87, 90],
                borderColor: '#673AB7',
                backgroundColor: 'rgba(103, 58, 183, 0.2)',
                tension: 0.4,
                fill: true,
                yAxisID: 'y1'
            }
        ]
    };

    const satisfactionTrendCanvas = document.getElementById('satisfactionTrendChart');
    if (satisfactionTrendCanvas) {
        // Destroy existing chart if it exists
        const existingChart = Chart.getChart(satisfactionTrendCanvas);
        if (existingChart) {
            existingChart.destroy();
        }
        
        new Chart(satisfactionTrendCanvas, {
            type: 'line',
            data: satisfactionTrendData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Customer Satisfaction Trend',
                        font: { size: 14 }
                    },
                    legend: {
                        labels: {
                            boxWidth: 12,
                            font: { size: 11 }
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        min: 0,
                        max: 10,
                        title: {
                            display: true,
                            text: 'Satisfaction Score',
                            font: { size: 11 }
                        },
                        ticks: {
                            font: { size: 10 }
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        min: 0,
                        max: 100,
                        grid: {
                            drawOnChartArea: false
                        },
                        title: {
                            display: true,
                            text: 'Response Rate (%)',
                            font: { size: 11 }
                        },
                        ticks: {
                            font: { size: 10 }
                        }
                    },
                    x: {
                        ticks: {
                            font: { size: 10 }
                        }
                    }
                }
            }
        });
    }
}

// Function to initialize the sales leaderboard table
function initializeSalesLeaderboard() {
    const comparisonSection = document.getElementById('executive-comparison-section');
    if (!comparisonSection) return;
    
    // Check if table already exists
    if (document.getElementById('sales-leaderboard')) return;
    
    // Create table container
    const salesLeaderboardContainer = document.createElement('div');
    salesLeaderboardContainer.className = 'sales-leaderboard-container';
    
    // Create controls
    const salesControls = document.createElement('div');
    salesControls.className = 'sales-controls';
    
    const periodSelector = document.createElement('select');
    periodSelector.className = 'period-selector';
    periodSelector.innerHTML = `
        <option value="monthly">Monthly (Current)</option>
        <option value="quarterly">Quarterly</option>
        <option value="yearly">Yearly</option>
    `;
    
    const exportButton = document.createElement('button');
    exportButton.className = 'export-btn';
    exportButton.setAttribute('data-table', 'sales-leaderboard');
    exportButton.textContent = 'Export to CSV';
    
    salesControls.appendChild(periodSelector);
    salesControls.appendChild(exportButton);
    
    // Create table
    const salesLeaderboardTable = document.createElement('table');
    salesLeaderboardTable.id = 'sales-leaderboard';
    
    // Create table caption
    const caption = document.createElement('caption');
    caption.textContent = 'Sales Executive Leaderboard';
    salesLeaderboardTable.appendChild(caption);
    
    // Create table header
    const thead = document.createElement('thead');
    thead.innerHTML = `
        <tr>
            <th width="5%">Rank</th>
            <th width="20%">Executive</th>
            <th width="40%">Sales Performance</th>
            <th width="15%">Amount</th>
            <th width="10%">vs. Last Period</th>
            <th width="10%">Leads</th>
        </tr>
    `;
    salesLeaderboardTable.appendChild(thead);
    
    // Create table body with sample data
    const tbody = document.createElement('tbody');
    
    // Sample data - replace with actual data
    const salesData = [
        { rank: 1, name: 'John Doe', amount: 85000, percentage: 100, trend: '+12%', leads: 32 },
        { rank: 2, name: 'Jane Smith', amount: 76500, percentage: 90, trend: '+8%', leads: 28 },
        { rank: 3, name: 'Mike Johnson', amount: 68000, percentage: 80, trend: '+5%', leads: 25 },
        { rank: 4, name: 'Sarah Williams', amount: 61200, percentage: 72, trend: '-3%', leads: 23 },
        { rank: 5, name: 'Robert Brown', amount: 58300, percentage: 69, trend: '+7%', leads: 20 },
        { rank: 6, name: 'Emily Davis', amount: 52700, percentage: 62, trend: '+2%', leads: 18 },
        { rank: 7, name: 'David Wilson', amount: 48500, percentage: 57, trend: '-5%', leads: 15 },
        { rank: 8, name: 'Lisa Anderson', amount: 45800, percentage: 54, trend: '+1%', leads: 14 }
    ];
    
    salesData.forEach(data => {
        const row = document.createElement('tr');
        
        // Rank cell with color coding for top 3
        const rankCell = document.createElement('td');
        rankCell.className = `rank-cell rank-${data.rank <= 3 ? data.rank : ''}`;
        rankCell.textContent = `#${data.rank}`;
        
        // Name cell
        const nameCell = document.createElement('td');
        nameCell.textContent = data.name;
        
        // Performance bar cell
        const performanceCell = document.createElement('td');
        performanceCell.innerHTML = `
            <div class="sales-bar-container">
                <div class="sales-bar" style="width: ${data.percentage}%"></div>
            </div>
        `;
        
        // Amount cell
        const amountCell = document.createElement('td');
        amountCell.className = 'sales-amount';
        amountCell.textContent = `$${data.amount.toLocaleString()}`;
        
        // Trend cell with color coding
        const trendCell = document.createElement('td');
        trendCell.className = data.trend.startsWith('+') ? 'trend-positive' : 'trend-negative';
        trendCell.textContent = data.trend;
        
        // Leads cell
        const leadsCell = document.createElement('td');
        leadsCell.className = 'lead-count';
        leadsCell.textContent = data.leads;
        
        // Append cells to row
        row.appendChild(rankCell);
        row.appendChild(nameCell);
        row.appendChild(performanceCell);
        row.appendChild(amountCell);
        row.appendChild(trendCell);
        row.appendChild(leadsCell);
        
        // Append row to tbody
        tbody.appendChild(row);
    });
    
    salesLeaderboardTable.appendChild(tbody);
    
    // Append controls and table to container
    salesLeaderboardContainer.appendChild(salesControls);
    salesLeaderboardContainer.appendChild(salesLeaderboardTable);
    
    // Find and replace any existing sales performance chart
   // const existingChart = comparisonSection.querySelector('.chart-container');
   // if (existingChart) {
   //     comparisonSection.replaceChild(salesLeaderboardContainer, existingChart);
   // } else {
   //     comparisonSection.appendChild(salesLeaderboardContainer);
   // }
    
    // Add event listener to export button
    exportButton.addEventListener('click', function() {
        const tableId = this.getAttribute('data-table');
        const table = document.getElementById(tableId);
        if (table) {
            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
            
            let csvContent = headers.join(',') + '\n';
            
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const data = Array.from(row.querySelectorAll('td')).map(td => {
                    let content = td.textContent.trim();
                    // Replace commas with a space to prevent CSV issues
                    content = content.replace(/,/g, ' ');
                    // Enclose in quotes if there's a space
                    if (content.includes(' ')) {
                        content = '"' + content + '"';
                    }
                    return content;
                });
                csvContent += data.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${tableId}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    });
    
    // Add event listener to period selector
    periodSelector.addEventListener('change', function() {
        const period = this.value;
        // Update table data based on selected period
        // This would typically involve an API call or switching to different predefined data
        
        // For demonstration, we'll just update the caption
        const tableCaption = salesLeaderboardTable.querySelector('caption');
        if (tableCaption) {
            let captionText = 'Sales Executive Leaderboard - ';
            switch(period) {
                case 'monthly':
                    captionText += 'Monthly (Current)';
                    break;
                case 'quarterly':
                    captionText += 'Quarterly';
                    break;
                case 'yearly':
                    captionText += 'Yearly';
                    break;
                default:
                    captionText += 'Monthly (Current)';
            }
            tableCaption.textContent = captionText;
        }
    });
}

// Call initializeCharts when the document is loaded
document.addEventListener("DOMContentLoaded", function() {
    initializeCharts();
    
    // Check if we need to initialize the satisfaction chart right away
    const feedbackSection = document.getElementById("feedback-section");
    if (feedbackSection && feedbackSection.classList.contains('active')) {
        initializeSatisfactionChart();
    }
});

// Initialize all charts when the window is fully loaded
window.onload = function() {
    initializeCharts();
    initializeSatisfactionChart();
};
var salesCtx = document.getElementById('salesContributionChart')?.getContext('2d');
if (salesCtx) {
    new Chart(salesCtx, {
        type: 'bar',
        data: {
            labels: ['Mark Wilson', 'Sarah Davis', 'Robert Johnson', 'Jennifer Lee', 'Michael Brown'],
            datasets: [{
                label: 'Sales Contribution (%)',
                data: [28.6, 25.0, 21.4, 17.8, 7.2],
                backgroundColor: ['#FF5733', '#33FF57', '#3357FF', '#FF33A1', '#FFC300'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Contribution (%)'
                    }
                }
            }
        }
    });
} else {
    console.error("salesContributionChart not found");
}
//now 1
document.addEventListener("DOMContentLoaded", function () {
    const assignTargetBtn = document.getElementById("assign-target-btn");
    const assignTargetTab = document.getElementById("assignTargetTab");
    const assignTargetOverlay = document.getElementById("assignTargetOverlay");
    const closeAssignTarget = document.getElementById("closeAssignTarget");
    const assignTargetForm = document.getElementById("assignTargetForm");

    // Example data for executives
    const executorsData = [
        { name: "Mark Wilson", achieved: 20, assigned: 30 },
        { name: "Sarah Davis", achieved: 15, assigned: 25 },
        { name: "Robert Johnson", achieved: 10, assigned: 20 },
        { name: "Jennifer Adams", achieved: 8, assigned: 18 },
        { name: "Michael Carter", achieved: 5, assigned: 15 },
    ];

    // Show Assign Target Mini-tab
    assignTargetBtn.addEventListener("click", function () {
        assignTargetTab.style.display = "flex";
        assignTargetOverlay.style.display = "block"; // Show the transparent layer

        // Populate the dropdown with updated data
        const executiveSelect = document.getElementById("executive");
        executiveSelect.innerHTML = ""; // Clear existing options
        executorsData.forEach((executor) => {
            const option = document.createElement("option");
            option.value = executor.name;
            option.textContent = `${executor.name} (Achieved: ${executor.achieved}/${executor.assigned})`;
            executiveSelect.appendChild(option);
        });
    });

    // Close Assign Target Mini-tab
    closeAssignTarget.addEventListener("click", function () {
        assignTargetTab.style.display = "none";
        assignTargetOverlay.style.display = "none"; // Hide the transparent layer
    });

    // Handle Assign Target Form Submission
    assignTargetForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const executive = document.getElementById("executive").value;
        const target = document.getElementById("target").value;
        alert(`Target of ${target} assigned to ${executive}`);
        assignTargetTab.style.display = "none";
        assignTargetOverlay.style.display = "none"; // Hide the transparent layer
    });

    // Close the mini-tab if the overlay is clicked
    assignTargetOverlay.addEventListener("click", function () {
        assignTargetTab.style.display = "none";
        assignTargetOverlay.style.display = "none";
    });
});
//now 2

//now popupdocument.addEventListener("DOMContentLoaded", function () {
    const urgentLeadsPopup = document.getElementById("urgentLeadsPopup");
    const viewFollowupsBtn = document.getElementById("viewFollowupsBtn");

    // Show the popup automatically for 2-3 seconds
    urgentLeadsPopup.style.display = "block";
    setTimeout(() => {
        urgentLeadsPopup.style.display = "none";
    }, 3000); // Popup duration reduced to 3 seconds

    // Redirect to follow-ups page when "Tap for Details" is clicked
    viewFollowupsBtn.addEventListener("click", function () {
        // Hide the popup
        urgentLeadsPopup.style.display = "none";

        // Navigate to the follow-ups section
        const followupsSection = document.getElementById("followups-section");
        const menuItems = document.querySelectorAll('.sidebar-menu a');

        // Deactivate all menu items
        menuItems.forEach(item => item.classList.remove('active'));

        // Activate the follow-ups menu item
        const followupsMenuItem = document.querySelector('[data-section="followups-section"]');
        if (followupsMenuItem) {
            followupsMenuItem.classList.add('active');
        }

        // Hide all sections
        const sections = document.querySelectorAll('.dashboard-section');
        sections.forEach(section => {
            section.classList.remove('active');
            section.style.display = 'none';
        });

        // Show the follow-ups section
        if (followupsSection) {
            followupsSection.classList.add('active');
            followupsSection.style.display = 'block';
        }
    });
    document.addEventListener("DOMContentLoaded", function () {
    const targetStatusBtn = document.getElementById("target-reminder-btn");
    const targetStatusModal = document.getElementById("targetStatusModal");
    const closeTargetStatus = document.getElementById("closeTargetStatus");
    const moreDetailsBtn = document.getElementById("moreDetailsBtn");

    // Example data for executives
    const executorsData = [
        { name: "Mark Wilson", achieved: 20, assigned: 30 },
        { name: "Sarah Davis", achieved: 15, assigned: 25 },
        { name: "Robert Johnson", achieved: 10, assigned: 20 },
        { name: "Jennifer Adams", achieved: 8, assigned: 18 },
        { name: "Michael Carter", achieved: 5, assigned: 15 },
    ];

    // Show the modal when the button is clicked
    targetStatusBtn.addEventListener("click", function () {
        targetStatusModal.style.display = "block";
        renderPieChart("all", executorsData);
    });

    // Close the modal
    closeTargetStatus.addEventListener("click", function () {
        targetStatusModal.style.display = "none";
    });

    // Redirect to Team Performance tab when "For More Details" is clicked
    moreDetailsBtn.addEventListener("click", function () {
        targetStatusModal.style.display = "none"; // Close the modal

        // Navigate to the Team Performance section
        const teamPerformanceSection = document.getElementById("team-performance-section");
        const menuItems = document.querySelectorAll('.sidebar-menu a');

        // Deactivate all menu items
        menuItems.forEach(item => item.classList.remove('active'));

        // Activate the Team Performance menu item
        const teamPerformanceMenuItem = document.querySelector('[data-section="team-performance-section"]');
        if (teamPerformanceMenuItem) {
            teamPerformanceMenuItem.classList.add('active');
        }

        // Hide all sections
        const sections = document.querySelectorAll('.dashboard-section');
        sections.forEach(section => {
            section.classList.remove('active');
            section.style.display = 'none';
        });

        // Show the Team Performance section
        if (teamPerformanceSection) {
            teamPerformanceSection.classList.add('active');
            teamPerformanceSection.style.display = 'block';
        }
    });

    // Render the pie chart
    function renderPieChart(selectedExecutive, data) {
        const ctx = document.getElementById("executivePieChart").getContext("2d");
        let chartData;

        if (selectedExecutive === "all") {
            const totalAchieved = data.reduce((sum, executor) => sum + executor.achieved, 0);
            const totalPending = data.reduce((sum, executor) => sum + (executor.assigned - executor.achieved), 0);
            chartData = {
                labels: ["Achieved", "Pending"],
                datasets: [
                    {
                        data: [totalAchieved, totalPending],
                        backgroundColor: ["#4CAF50", "#F44336"],
                    },
                ],
            };
        }

        // Destroy the existing chart if it exists
        if (Chart.getChart(ctx)) {
            Chart.getChart(ctx).destroy();
        }

        new Chart(ctx, {
            type: "pie",
            data: chartData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: "right",
                    },
                },
            },
        });
    }
});
//scroll
document.addEventListener("DOMContentLoaded", function () {
    const menuItems = document.querySelectorAll('.sidebar-menu a');
    const sections = document.querySelectorAll('.dashboard-section');

    menuItems.forEach(item => {
        item.addEventListener('click', function (event) {
            event.preventDefault();

            // Remove active class from all menu items
            menuItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');

            // Get the section ID
            const sectionId = this.getAttribute('data-section');

            // Hide all sections
            sections.forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });

            // Show the correct section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';

                // Scroll to the top of the page
                window.scrollTo({
                    top: 0,
                    behavior: 'instant' // Instantly scroll to the top
                });

                // Initialize charts or other elements if needed
                if (sectionId === "feedback-section") {
                    initializeSatisfactionChart();
                } else if (sectionId === "team-performance-section") {
                    initializeCharts();
                }
            }

            // If sidebar is open on mobile, close it after clicking
            const sidebar = document.querySelector('.sidebar');
            if (window.innerWidth <= 768 && sidebar) {
                sidebar.classList.remove('active');
            }
        });
    });

    // Ensure the first section is visible by default
    if (menuItems.length > 0) {
        menuItems[0].click();
    }
});// Place this JS at the end of your file or in a <script> tag after the HTML above
// Place this JS at the end of your file or in a <script> tag after the HTML above
document.addEventListener("DOMContentLoaded", function () {
    // Executive data with completed and assigned targets
    const executives = [
        { name: "Mark Wilson", completed: { sales: 8, revenue: 120000, enquiry: 15, booking: 4 }, assigned: { sales: 12, revenue: 250000, enquiry: 30, booking: 8 } },
        { name: "Sarah Davis", completed: { sales: 7, revenue: 90000, enquiry: 10, booking: 3 }, assigned: { sales: 10, revenue: 210000, enquiry: 22, booking: 7 } },
        { name: "Robert Johnson", completed: { sales: 6, revenue: 70000, enquiry: 8, booking: 2 }, assigned: { sales: 8, revenue: 180000, enquiry: 18, booking: 5 } },
        { name: "Jennifer Adams", completed: { sales: 5, revenue: 60000, enquiry: 7, booking: 2 }, assigned: { sales: 7, revenue: 150000, enquiry: 15, booking: 4 } },
        { name: "Michael Carter", completed: { sales: 3, revenue: 40000, enquiry: 5, booking: 1 }, assigned: { sales: 5, revenue: 120000, enquiry: 10, booking: 3 } }
    ];

    let selectedIndex = 0;

    // Populate dropdown
    const execSelect = document.getElementById("executiveSelect");
    executives.forEach((exec, idx) => {
        const opt = document.createElement("option");
        opt.value = idx;
        opt.textContent = exec.name;
        execSelect.appendChild(opt);
    });

    // Show executive details
    function updateExecutiveDetails(idx) {
        const exec = executives[idx];
        document.getElementById("executiveDetails").innerHTML = `
            <b>${exec.name}</b><br>
            <span style="color:#888;">Sales: </span> <b>${exec.completed.sales}</b> / <b>${exec.assigned.sales}</b> &nbsp; 
            <span style="color:#888;">Revenue: </span> <b>₹${exec.completed.revenue.toLocaleString()}</b> / <b>₹${exec.assigned.revenue.toLocaleString()}</b> &nbsp; 
            <span style="color:#888;">Enquiry: </span> <b>${exec.completed.enquiry}</b> / <b>${exec.assigned.enquiry}</b> &nbsp; 
            <span style="color:#888;">Booking: </span> <b>${exec.completed.booking}</b> / <b>${exec.assigned.booking}</b>
        `;
        // Clear input fields
        document.getElementById("salesInput").value = "";
        document.getElementById("revenueInput").value = "";
        document.getElementById("enquiryInput").value = "";
        document.getElementById("bookingInput").value = "";
    }

    execSelect.addEventListener("change", function () {
        selectedIndex = parseInt(this.value, 10);
        updateExecutiveDetails(selectedIndex);
    });

    // Initial display
    updateExecutiveDetails(selectedIndex);

    // Handle form submit
    document.getElementById("targetAllocationForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const exec = executives[selectedIndex];
        // Get new values (add to assigned)
        const addSales = parseInt(document.getElementById("salesInput").value, 10) || 0;
        const addRevenue = parseInt(document.getElementById("revenueInput").value, 10) || 0;
        const addEnquiry = parseInt(document.getElementById("enquiryInput").value, 10) || 0;
        const addBooking = parseInt(document.getElementById("bookingInput").value, 10) || 0;
        exec.assigned.sales += addSales;
        exec.assigned.revenue += addRevenue;
        exec.assigned.enquiry += addEnquiry;
        exec.assigned.booking += addBooking;

        // Show alarm
        const alarm = document.getElementById("target-alarm");
        alarm.style.display = "block";
        setTimeout(() => { alarm.style.display = "none"; }, 2500);

        // Update details and summary
        updateExecutiveDetails(selectedIndex);
        updateSummaryTable();
    });

    // Update summary table
    function updateSummaryTable() {
        const tbody = document.getElementById("assigned-summary-tbody");
        tbody.innerHTML = "";
        executives.forEach(exec => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${exec.name}</td>
                <td>${exec.completed.sales} / ${exec.assigned.sales}</td>
                <td>₹${exec.completed.revenue.toLocaleString()} / ₹${exec.assigned.revenue.toLocaleString()}</td>
                <td>${exec.completed.enquiry} / ${exec.assigned.enquiry}</td>
                <td>${exec.completed.booking} / ${exec.assigned.booking}</td>
            `;
            tbody.appendChild(tr);
        });
    }
    function updateLeadTargetAlarm() {
    // Calculate totals
    let totalAssigned = { sales: 0, revenue: 0, enquiry: 0, booking: 0 };
    let totalCompleted = { sales: 0, revenue: 0, enquiry: 0, booking: 0 };
    executives.forEach(exec => {
        totalAssigned.sales += exec.assigned.sales;
        totalAssigned.revenue += exec.assigned.revenue;
        totalAssigned.enquiry += exec.assigned.enquiry;
        totalAssigned.booking += exec.assigned.booking;
        totalCompleted.sales += exec.completed.sales;
        totalCompleted.revenue += exec.completed.revenue;
        totalCompleted.enquiry += exec.completed.enquiry;
        totalCompleted.booking += exec.completed.booking;
    });
    document.getElementById("leadTargetAlarmDetails").innerHTML = `
        <span><b>Sales:</b> ${totalCompleted.sales} / ${totalAssigned.sales}</span><br>
        <span><b>Revenue:</b> ₹${totalCompleted.revenue.toLocaleString()} / ₹${totalAssigned.revenue.toLocaleString()}</span><br>
        <span><b>Enquiry:</b> ${totalCompleted.enquiry} / ${totalAssigned.enquiry}</span><br>
        <span><b>Booking:</b> ${totalCompleted.booking} / ${totalAssigned.booking}</span>
    `;
}

    // After updateSummaryTable();
updateSummaryTable();
updateLeadTargetAlarm();
});

// ...existing code...
// ...existing code...




    // Example data for demonstration
    const teamTargets = {
        sales: 50,
        revenue: 1000000,
        accessories: 120
    };
    const executives = [
        { name: "Mark Wilson", completed: { sales: 12, revenue: 220000, accessories: 30 }, assigned: { sales: 15, revenue: 250000, accessories: 35 } },
        { name: "Sarah Davis", completed: { sales: 10, revenue: 180000, accessories: 22 }, assigned: { sales: 12, revenue: 210000, accessories: 25 } },
        { name: "Robert Johnson", completed: { sales: 8, revenue: 140000, accessories: 18 }, assigned: { sales: 10, revenue: 180000, accessories: 20 } },
        { name: "Jennifer Adams", completed: { sales: 7, revenue: 120000, accessories: 15 }, assigned: { sales: 8, revenue: 150000, accessories: 18 } },
        { name: "Michael Carter", completed: { sales: 5, revenue: 90000, accessories: 10 }, assigned: { sales: 7, revenue: 120000, accessories: 12 } }
    ];
    let selectedExec = 0;

    // Populate cards
    function updateCards() {
        // Team totals
        let salesAssigned = teamTargets.sales;
        let salesCompleted = executives.reduce((sum, e) => sum + e.completed.sales, 0);
        let salesAssignedToExecs = executives.reduce((sum, e) => sum + e.assigned.sales, 0);

        let revenueAssigned = teamTargets.revenue;
        let revenueAchieved = executives.reduce((sum, e) => sum + e.completed.revenue, 0);
        let revenueAssignedToExecs = executives.reduce((sum, e) => sum + e.assigned.revenue, 0);

        let accessoriesAssigned = teamTargets.accessories;
        let accessoriesAchieved = executives.reduce((sum, e) => sum + e.completed.accessories, 0);
        let accessoriesAssignedToExecs = executives.reduce((sum, e) => sum + e.assigned.accessories, 0);

        document.getElementById("sales-assigned").textContent = salesAssigned;
        document.getElementById("sales-completed").textContent = salesCompleted + " / " + salesAssigned;
        document.getElementById("sales-progress").textContent = Math.round((salesCompleted/salesAssigned)*100) + "%";
        document.getElementById("revenue-achieved").textContent = "₹" + revenueAchieved.toLocaleString() + " / ₹" + revenueAssigned.toLocaleString();
        document.getElementById("revenue-progress").textContent = Math.round((revenueAchieved/revenueAssigned)*100) + "%";
        document.getElementById("accessories-achieved").textContent = accessoriesAchieved + " / " + accessoriesAssigned;
        document.getElementById("accessories-progress").textContent = Math.round((accessoriesAchieved/accessoriesAssigned)*100) + "%";
        document.getElementById("exec-targets").textContent = salesAssignedToExecs + " / " + salesAssigned;
    }

    // Populate executive dropdown
    function populateExecDropdown() {
        const select = document.getElementById("execSelect");
        select.innerHTML = "";
        executives.forEach((exec, idx) => {
            const opt = document.createElement("option");
            opt.value = idx;
            opt.textContent = exec.name;
            select.appendChild(opt);
        });
    }

    // Show executive details
    function updateExecDetails(idx) {
        const exec = executives[idx];
        document.getElementById("execDetails").innerHTML = `
            <span>Sales: <b>${exec.completed.sales}</b> / <b>${exec.assigned.sales}</b></span> &nbsp;|&nbsp;
            <span>Revenue: <b>₹${exec.completed.revenue.toLocaleString()}</b> / <b>₹${exec.assigned.revenue.toLocaleString()}</b></span> &nbsp;|&nbsp;
            <span>Accessories: <b>${exec.completed.accessories}</b> / <b>${exec.assigned.accessories}</b></span>
        `;
        document.getElementById("salesInput").value = "";
        document.getElementById("revenueInput").value = "";
        document.getElementById("accessoriesInput").value = "";
    }

    // Update summary table
    function updateSummaryTable() {
        const tbody = document.getElementById("summaryBody");
        tbody.innerHTML = "";
        executives.forEach(exec => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${exec.name}</td>
                <td>${exec.completed.sales} / ${exec.assigned.sales}</td>
                <td>₹${exec.completed.revenue.toLocaleString()} / ₹${exec.assigned.revenue.toLocaleString()}</td>
                <td>${exec.completed.accessories} / ${exec.assigned.accessories}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    // Handle form submit
    document.getElementById("targetForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const exec = executives[selectedExec];
        const addSales = parseInt(document.getElementById("salesInput").value, 10) || 0;
        const addRevenue = parseInt(document.getElementById("revenueInput").value, 10) || 0;
        const addAccessories = parseInt(document.getElementById("accessoriesInput").value, 10) || 0;
        exec.assigned.sales += addSales;
        exec.assigned.revenue += addRevenue;
        exec.assigned.accessories += addAccessories;
        updateExecDetails(selectedExec);
        updateSummaryTable();
        updateCards();
        // Optionally, show a quick notification
        document.querySelector('.alarm-card').style.background = "#e8f5e9";
        document.querySelector('.alarm-card').style.color = "#388e3c";
        document.querySelector('.alarm-card i').className = "fas fa-check-circle";
        document.querySelector('.alarm-card span').textContent = "Target updated successfully!";
        setTimeout(() => {
            document.querySelector('.alarm-card').style.background = "#fffbe7";
            document.querySelector('.alarm-card').style.color = "#b26a00";
            document.querySelector('.alarm-card i').className = "fas fa-bell";
            document.querySelector('.alarm-card span').textContent = "Reminder: Please review and update your team's target allocations for this month!";
        }, 2000);
    });

    // Dropdown change
    document.getElementById("execSelect").addEventListener("change", function() {
        selectedExec = parseInt(this.value, 10);
        updateExecDetails(selectedExec);
    });

    // Initial load
    populateExecDropdown();
    updateExecDetails(selectedExec);
    updateSummaryTable();
    updateCards();
// ...existing code...
// ...existing code...


document.querySelectorAll("#followup-table tbody tr").forEach(row => {
    const probCell = row.querySelector('[data-label="Conversion Probability"]');
    const span = probCell.querySelector("span");
    const percent = parseInt(span.textContent.replace('%', '').trim());

    let label = '';
    if (percent > 95) label = 'Booked';
    else if (percent > 76) label = 'B→R';
    else if (percent > 51) label = 'T→B';
    else if (percent > 35) label = 'E→T';
    else if (percent > 15) label = 'Enquiry';
    else label = 'New Lead';

    if (label) {
        span.innerHTML = `${percent}% <br><small style="color:#3f51b5;font-weight:bold;">${label}</small>`;
    }
});

function closePopup() {
    document.getElementById("customer-popup").style.display = "none";
}

document.querySelectorAll(".status-update-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
        const row = btn.closest("tr");
        const name = row.querySelector('[data-label="Lead Name"]').textContent;
        const contact = row.querySelector('[data-label="Last Contact"]').textContent;
        const next = row.querySelector('[data-label="Next Follow-up"]').textContent;
        const assigned = row.querySelector('[data-label="Assigned To"]').textContent;
        const prob = row.querySelector('[data-label="Conversion Probability"] span').textContent;

        document.getElementById("popup-content").innerHTML = `
            <h3 style="margin-bottom:10px;">Customer Details</h3>
            <p><strong>Name:</strong> ${name}</p>
            <p><strong>Last Contact:</strong> ${contact}</p>
            <p><strong>Next Follow-up:</strong> ${next}</p>
            <p><strong>Assigned To:</strong> ${assigned}</p>
            <p><strong>Conversion:</strong> ${prob}</p>
        `;
        document.getElementById("customer-popup").style.display = "block";
    });
});




/* ================================
   Executive Tasks (Comparison Section)
   ================================ */
(function(){
  const STORAGE_KEY = "kia-exec-tasks-v1";

  // --------- Helpers ---------
  function loadTasks(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      const data = JSON.parse(raw);
      return Array.isArray(data) ? data : [];
    } catch(e){
      console.warn("Failed to load tasks", e);
      return [];
    }
  }
  function saveTasks(list){
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    } catch(e){
      console.warn("Failed to save tasks", e);
    }
  }
  let tasks = loadTasks();

  // Build executive list + id map from DOM (Lead Allocation table preferred)
  function buildExecMap(){
    const map = {}; // name -> id (string)
    // scan lead allocation
    document.querySelectorAll('#leads-table tbody tr').forEach(row=>{
      const nameCell = row.querySelector('[data-label="Assigned Executive"]');
      const idCell = row.querySelector('[data-label="Executive ID"]');
      if(!nameCell) return;
      const name = nameCell.textContent.trim();
      const id = idCell ? idCell.textContent.trim() : "";
      if(name) map[name] = id;
    });
    // fallback: comparison table names
    document.querySelectorAll('#comparison-table tbody tr').forEach(row=>{
      const nameCell = row.querySelector('[data-label="Executive Name"]');
      if(!nameCell) return;
      const name = nameCell.textContent.trim();
      if(name && !(name in map)) map[name] = ""; // no id
    });
    return map;
  }
  let execMap = buildExecMap();

  function getExecNames(){ return Object.keys(execMap); }
  function getExecId(name){ return execMap[name] || ""; }

  // DOM refs
  const form = document.getElementById("execTaskForm");
  const nameSel = document.getElementById("execTaskExecSelect");
  const idSel   = document.getElementById("execTaskExecIdSelect");
  const prSel   = document.getElementById("execTaskPriority");
  const dueInp  = document.getElementById("execTaskDueDate");
  const descInp = document.getElementById("execTaskDesc");
  const sumBody = document.getElementById("execTaskSummaryBody");
  const sumTable = document.getElementById("exec-task-summary-table");

  if(!form){ console.warn("Exec task module form missing; skipping init."); return; }

  // Populate selects
  function populateExecSelects(){
    const names = getExecNames();
    nameSel.innerHTML = `<option value="" disabled selected>Select Executive</option>`;
    idSel.innerHTML = `<option value="">Auto</option>`;
    names.forEach(n=>{
      const opt = document.createElement("option");
      opt.value = n;
      opt.textContent = n;
      nameSel.appendChild(opt);

      const id = getExecId(n);
      const idOpt = document.createElement("option");
      idOpt.value = id;
      idOpt.textContent = id || "(none)";
      idSel.appendChild(idOpt);
    });
  }
  populateExecSelects();

  // Sync ID when name selected (auto fill)
  nameSel.addEventListener("change", ()=>{
    const id = getExecId(nameSel.value);
    idSel.value = id;
  });

  // Submit new task
  form.addEventListener("submit", e=>{
    e.preventDefault();
    const execName = nameSel.value;
    if(!execName){ alert("Select executive."); return; }

    let execId = idSel.value;
    if(!execId){ execId = getExecId(execName); } // auto fallback

    const priority = prSel.value;
    const desc = descInp.value.trim();
    if(!desc){ alert("Task description required."); return; }

    const t = {
      id: "et_" + Date.now(),
      execName,
      execId,
      description: desc,
      priority,
      dueDate: dueInp.value || null,
      status: "Pending",              // Pending | In Progress | Completed
      createdDate: new Date().toISOString(),
      completionDate: null
    };
    tasks.push(t);
    saveTasks(tasks);
    form.reset();
    nameSel.selectedIndex = 0;
    idSel.selectedIndex = 0;
    prSel.value = "Medium";
    renderSummary();
  });

  // ---- Summary Render ----
  function renderSummary(){
    execMap = buildExecMap(); // in case DOM changed
    const names = getExecNames();
    sumBody.innerHTML = "";
    names.forEach(n=>{
      const id = getExecId(n);
      const myTasks = tasks.filter(t=>t.execName===n);
      const total = myTasks.length;
      const completed = myTasks.filter(t=>t.status==="Completed").length;
      const active = total - completed;
      const highPri = myTasks.filter(t=>t.priority==="High" && t.status!=="Completed").length;

      const tr = document.createElement("tr");
      tr.className = "exec-task-summary-row";
      tr.setAttribute("data-exec", n);
      tr.innerHTML = `
        <td>${n}</td>
        <td>${id || "-"}</td>
        <td>${completed} / ${total}</td>
        <td>${active}</td>
        <td>${highPri}</td>
      `;
      sumBody.appendChild(tr);
    });
  }

  // ---- Expand / Collapse Details ----
  sumBody.addEventListener("click", e=>{
    const row = e.target.closest("tr.exec-task-summary-row");
    if(!row) return;
    const name = row.getAttribute("data-exec");
    toggleDetailRow(row, name);
  });

  function toggleDetailRow(summaryRow, execName){
    // Already open?
    const next = summaryRow.nextElementSibling;
    if (next && next.classList.contains("exec-task-detail-row")){
      next.remove();
      return;
    }
    // close any other open detail rows
    document.querySelectorAll(".exec-task-detail-row").forEach(el=>el.remove());

    // Build detail table rows
    const all = tasks.filter(t=>t.execName===execName);
    const sorted = sortDetail(all);

    const wrapTr = document.createElement("tr");
    wrapTr.className = "exec-task-detail-row";
    const td = document.createElement("td");
    td.colSpan = 5;
    td.innerHTML = buildDetailHtml(sorted);
    wrapTr.appendChild(td);
    summaryRow.insertAdjacentElement("afterend", wrapTr);

    // attach detail button events
    attachDetailRowEvents(wrapTr, sorted);
  }

  // Sort: incomplete first by dueDate->priority->created; then completed by completionDate desc
  function sortDetail(list){
    const prRank = {High:3, Medium:2, Low:1};
    return list.slice().sort((a,b)=>{
      const adone = a.status==="Completed";
      const bdone = b.status==="Completed";
      if(adone !== bdone) return adone?1:-1;
      if(!adone){
        const ad = a.dueDate ? new Date(a.dueDate) : new Date("9999-12-31");
        const bd = b.dueDate ? new Date(b.dueDate) : new Date("9999-12-31");
        if(ad-bd!==0) return ad-bd;
        if(prRank[a.priority]!==prRank[b.priority]) return prRank[b.priority]-prRank[a.priority];
        return new Date(a.createdDate)-new Date(b.createdDate);
      }
      const ac = a.completionDate?new Date(a.completionDate):0;
      const bc = b.completionDate?new Date(b.completionDate):0;
      return bc-ac;
    });
  }

  function buildDetailHtml(list){
    if(!list.length){
      return `<div class="exec-task-detail-inner"><em>No tasks yet.</em></div>`;
    }
    let rows = "";
    list.forEach(t=>{
      const rowCls = priorityStripeClass(t.priority);
      const pill = statusPill(t);
      rows += `
        <tr class="${rowCls}" data-id="${t.id}">
          <td>${t.description}</td>
          <td>${t.dueDate?fmtDate(t.dueDate):"-"}</td>
          <td>${t.priority}</td>
          <td>${pill}</td>
          <td>
            ${t.status!=="Completed" ? `<button class="dashboard-btn exec-task-done-btn" data-id="${t.id}">Done</button>` : `<button class="dashboard-btn exec-task-reopen-btn" data-id="${t.id}">Reopen</button>`}
            <button class="dashboard-btn exec-task-del-btn" data-id="${t.id}">Delete</button>
          </td>
        </tr>
      `;
    });
    return `
      <div class="exec-task-detail-inner">
        <table>
          <thead>
            <tr>
              <th>Task</th>
              <th>Due</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    `;
  }

  function priorityStripeClass(p){
    if(p==="High") return "exec-task-row-high";
    if(p==="Medium") return "exec-task-row-medium";
    return "exec-task-row-low";
  }

  function statusPill(t){
    const overdue = isOverdue(t);
    let cls = "exec-task-pill ";
    let txt = t.status;
    if(t.status==="Completed") cls+="exec-task-completed";
    else if(overdue){ cls+="exec-task-overdue"; txt="Overdue"; }
    else if(t.status==="In Progress") cls+="exec-task-progress";
    else cls+="exec-task-pending";
    return `<span class="${cls}">${txt}</span>`;
  }
  function isOverdue(t){
    if(t.status==="Completed") return false;
    if(!t.dueDate) return false;
    const today = new Date();
    const due = new Date(t.dueDate);
    return due < today.setHours(0,0,0,0);
  }

  function fmtDate(d){
    const dt = new Date(d);
    if(Number.isNaN(dt)) return d;
    return dt.toLocaleDateString(undefined,{year:"numeric",month:"short",day:"numeric"});
  }

  function attachDetailRowEvents(detailRow, list){
    detailRow.addEventListener("click", e=>{
      const id = e.target.getAttribute("data-id");
      if(!id) return;
      const idx = tasks.findIndex(x=>x.id===id);
      if(idx<0) return;

      if(e.target.classList.contains("exec-task-done-btn")){
        tasks[idx].status="Completed";
        tasks[idx].completionDate=new Date().toISOString();
      } else if(e.target.classList.contains("exec-task-reopen-btn")){
        tasks[idx].status="Pending";
        tasks[idx].completionDate=null;
      } else if(e.target.classList.contains("exec-task-del-btn")){
        if(confirm("Delete this task?")){
          tasks.splice(idx,1);
        } else return;
      }
      saveTasks(tasks);
      renderSummary(); // this re-renders summary and collapses detail; optional: reopen same exec
    });
  }

  // Export summary table CSV (reuses your pattern)
  const exportBtn = document.querySelector('#exec-task-summary-container .export-btn');
  if(exportBtn){
    exportBtn.addEventListener("click", ()=>{
      const table = sumTable;
      if(!table) return;
      const headers = Array.from(table.querySelectorAll('thead th')).map(th=>th.textContent.trim());
      let csv = headers.join(',')+'\n';
      table.querySelectorAll('tbody tr').forEach(tr=>{
        const cells = Array.from(tr.children).map(td=> {
          let t = td.textContent.trim().replace(/,/g,' ');
          if(t.includes(' ')) t=`"${t}"`;
          return t;
        });
        csv += cells.join(',')+'\n';
      });
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url;
      a.download='executive-tasks-summary.csv';
      a.click();
      URL.revokeObjectURL(url);
    });
  }

  // Initial paint
  renderSummary();
})();
</script>

</body>
</html>
